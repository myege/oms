<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.what21.dao.SzqgOrderDao">
	<resultMap type="SzqgOrder" id="SzqgOrderResultMap">
		<id property="id" column="id"/>
		<result property="guid" column="guid"/>
		<result property="commitTime" column="commitTime"/>
		<result property="appStatus" column="appStatus"/>
		<result property="strategy" column="strategy"/>
		<result property="orderNo" column="orderNo"/>
		<result property="consignee" column="consignee"/>
		<result property="consigneeTelephone" column="consigneeTelephone"/>
		<result property="consigneeIdType" column="consigneeIdType"/>
		<result property="consigneeIdNumber" column="consigneeIdNumber"/>
		<result property="consigneePrvince" column="consigneePrvince"/>
		<result property="consigneeCity" column="consigneeCity"/>
		<result property="consigneeCounty" column="consigneeCounty"/>
		<result property="consigneeAddress" column="consigneeAddress"/>
		<result property="goodsValue" column="goodsValue"/>
		<result property="freight" column="freight"/>
		<result property="discount" column="discount"/>
		<result property="taxTotal" column="taxTotal"/>
		<result property="acturalPaid" column="acturalPaid"/>
		<result property="currency" column="currency"/>
		<result property="buyerRegNo" column="buyerRegNo"/>
		<result property="buyerName" column="buyerName"/>
		<result property="buyerTelephone" column="buyerTelephone"/>
		<result property="buyerIdType" column="buyerIdType"/>
		<result property="buyerIdNumber" column="buyerIdNumber"/>
		<result property="payCode" column="payCode"/>
		<result property="payName" column="payName"/>
		<result property="payTransactionId" column="payTransactionId"/>
		<result property="carrier" column="carrier"/>
		<result property="logisticsCode" column="logisticsCode"/>
		<result property="message" column="message"/>
		<result property="userId" column="userId"/>
		<result property="createDateTime" column="createDateTime"/>
		<result property="status" column="status"/>
		
	</resultMap>
	
	<select id="findAll" resultMap="SzqgOrderResultMap" parameterType="java.util.Map">
		select * from szqg_order where 1=1
		and status = #{status} 
		<!--  <if test="status == 4">
			and status=4
		</if> -->
	<!--	<if test="auditstatus == 9">
			and status=9
		</if>
		<if test="auditstatus != 8 and auditstatus != 9 and auditstatus != 7">
			and status !=9  and status !=8 and status != 7
		</if> -->
	    <if test="userId != null and userId != 0">
	 		and userId = #{userId} 
	    </if>
	    
	   <!--  <if test="paramName == 'receiveMan' and paramValue !='' and paramValue !=null">
			and receiveMan like '%${paramValue}%'
		</if>
		<if test="paramName == 'txLogisticID' and paramValue !='' and paramValue !=null">
			and txLogisticID like '%${paramValue}%'
		</if>
		<if test="paramName == 'carrier' and paramValue !='' and paramValue !=null">
			and carrier like '%${paramValue}%'
		</if>
		<if test="paramName == 'pc' and paramValue !='' and paramValue !=null">
			and pc like '%${paramValue}%'
		</if>
		<if test="paramName == 'itemName' and paramValue !='' and paramValue !=null">
			and itemName like '%${paramValue}%'
		</if>
		<if test="paramName == 'mailNo' and paramValue !='' and paramValue !=null">
			and mailNo like '%${paramValue}%'
		</if>
		<if test="paramName == 'payNumber' and paramValue !='' and paramValue !=null">
			and payNumber like '%${paramValue}%'
		</if>
		<if test="mark != null">
			and mark = ${mark}
		</if>
		<if test="wms != null">
			and isPushToWms = ${wms}
		</if>
		<if test="txLogisticID != null">
			and txLogisticID  like '%${txLogisticID}%'
		</if>
		<if test="receiveMan != null">
			and receiveMan like '%${receiveMan}%'
		</if>
		<if test="pc != null">
			and pc like '%${pc}%'
		</if>
		<if test="itemName != null">
			and itemName like '%${itemName}%'
		</if>
		<if test="mailNo != null">
			and mailNo like '%${mailNo}%'
		</if>
		<if test="payNumber != null">
			and payNumber like '%${payNumber}%'
		</if>
		
		<if test="merchantNum != null">
			and merchantNum like '%${merchantNum}%'
		</if> -->
		
		order by ddguid,qdguid,ydzt,createDateTime desc  
		
		LIMIT ${startPage},${endPage}
		
		
	</select>
	<select id="count" resultType="java.lang.Integer" parameterType="java.util.Map">
			SELECT count(1) from szqg_order
		<where>
				1=1 and status = #{status} 
			<if test="userId != null and userId != 0">
	            and userId=#{userId} 
	        </if>
			<if test="text3 != null and text3!=''">
				and itemName like '%${text3}%'
		    </if>
		    <if test="text4 != null and text4!=''">
				and companyCode like '%${text4}%'
		    </if>
		    <if test="text5 != null and text5!=''">
				and itemSKU like '%${text5}%'
		    </if>
			<if test="time3 !='' and time3 != null and  (time4 !='' or time4 !=null)">
				and createDateTime &gt;='${time3}' and createDateTime &lt;='${time4}'
			</if>
		</where>
				 
	</select>
	
	<select id="dateTime" resultMap="SzqgOrderResultMap" parameterType="java.util.Map">
	 	SELECT * from item
	<where>
			1=1
		<if test="userId != null and userId != 0">
          	and userId = #{userId} 
       	 </if>
		<if test="text3 != null and text3!=''">
			and itemName like '%${text3}%'
	    </if>
	    <if test="text4 != null and text4!=''">
			and companyCode like '%${text4}%'
	    </if>
	    <if test="text5 != null and text5!=''">
				and itemSKU like '%${text5}%'
		    </if>
		<if test="time3 !='' and time3 != null and  (time4 !='' or time4 !=null)">
			and createDateTime &gt;='${time3}' and createDateTime &lt;='${time4}'
		</if>
		</where>
				order by createDateTime
				LIMIT #{startPage},#{endPage}
	</select>

	<delete id ="deleteItem" parameterType="String">
		DELETE  FROM item WHERE id = #{id}
	</delete>

	
	<select id="findBySku" resultMap="SzqgOrderResultMap" parameterType="Item">
	     select * from szqg_order where orderno=#{orderNo}
	</select>
	
	<insert id="insert" parameterType="Item">
		insert into item (userId,itemSpec,unitWeight,unitDesc, createDateTime, 
		country,costPrice,itemSKU,itemName,companyCode,vendorItemCode,remark,xz,xh,itemcode,wmstype,
		listPrice,hscode,oneUnitDesc,twoUnitDesc,countryOfOrigin,internalNumber,taxRate,productRecordNo)
		values(#{userId},#{itemSpec},#{unitWeight},#{unitDesc},
		#{createDateTime},#{country},#{costPrice},#{itemSKU},#{itemName},
		#{companyCode},#{vendorItemCode},#{remark},#{xz},#{xh},#{itemcode},#{wmstype},#{listPrice},
		#{hscode},#{oneUnitDesc},#{twoUnitDesc},#{countryOfOrigin},#{internalNumber},#{taxRate},#{productRecordNo})
	</insert>
	
	<update id="updateItme" parameterType='Item'>
		update item set
		userId=#{userId},itemSpec=#{itemSpec},unitWeight=#{unitWeight},unitDesc=#{unitDesc},itemcode=#{itemcode},country=#{country},costPrice=#{costPrice},itemSKU=#{itemSKU},
		itemName=#{itemName},companyCode=#{companyCode},vendorItemCode=#{vendorItemCode},remark=#{remark},
		xz=#{xz},xh=#{xh},listPrice=#{listPrice},hscode=#{hscode},
		oneUnitDesc=#{oneUnitDesc},countryOfOrigin=#{countryOfOrigin},twoUnitDesc=#{twoUnitDesc},internalNumber=#{internalNumber},
		taxRate=#{taxRate},productRecordNo=#{productRecordNo}
		where id=#{id}
	</update>
	
	<insert id="insertBatch" >
		insert into item (userId,itemSpec,unitWeight,unitDesc,createDateTime,
		country,costPrice,itemSKU,itemName,wmstype,companyCode,vendorItemCode,remark,xz,xh,
		listPrice,hscode,oneUnitDesc,twoUnitDesc,countryOfOrigin,internalNumber,taxRate,productRecordNo,itemcode)
		values
		<foreach collection="list" item="item" separator=",">		
		(#{item.userId},#{item.itemSpec},#{item.unitWeight},#{item.unitDesc},
		#{item.createDateTime},#{item.country},#{item.costPrice},#{item.itemSKU},#{item.itemName},#{item.wmstype},
		#{item.companyCode},#{item.vendorItemCode},#{item.remark},#{item.xz},#{item.xh},#{item.listPrice},
		#{item.hscode},#{item.oneUnitDesc},#{item.twoUnitDesc},#{item.countryOfOrigin},#{item.internalNumber},#{item.taxRate},#{item.productRecordNo},#{item.itemcode})
		</foreach>
	</insert>

	<select id="findArray" resultMap="SzqgOrderResultMap" >
		select * from item where id in
	<foreach collection="array" item="item" separator="," open="(" close=")">		
		#{item}
	</foreach>
	</select>
	<select id="finImpWms" resultMap="SzqgOrderResultMap" >select * from item</select>
	
	<update id="updateWmsType">
			UPDATE item SET wmstype = 1 WHERE id in
		<foreach collection="list" item="item" open="(" close=")" separator=",">
		 #{item.id}
		</foreach>
	</update>
	<update id="updateWmsType2">
			UPDATE item SET wmstype = 1 WHERE id =${gjz} 
	
	</update>
	<select id="findById" resultType="com.what21.model.Item" parameterType="String">
		select * from item where id = #{id}
	</select>
	
	<update id="updateById" parameterType="com.what21.model.Item">
		update item set
		 itemSKU = #{itemSKU},
		 itemcode = #{itemcode},
		 itemName = #{itemName},
		 itemSpec = #{itemSpec},
		 unitDesc = #{unitDesc},
		 companyCode = #{companyCode},
		 hscode = #{hscode},
		 oneUnitDesc = #{oneUnitDesc},
		 twoUnitDesc = #{twoUnitDesc},
		 productRecordNo = #{productRecordNo},
		 unitWeight = #{unitWeight},
		 taxRate = #{taxRate},
		 country = #{country},
		 internalNumber = #{internalNumber}
		where id = #{id}
	</update>
	<insert id="save" parameterType="com.what21.model.Item">
		Insert into item
			(itemSKU, itemcode, 
			itemName,itemSpec,
			unitDesc,companyCode,
			hscode,oneUnitDesc,
			twoUnitDesc,productRecordNo,
			unitWeight,taxRate,
			country,internalNumber,
			createDateTime)
			 	values
			 (#{itemSKU},#{itemcode},
			 #{itemName},#{itemSpec},
			 #{unitDesc},#{companyCode},
			 #{hscode},#{oneUnitDesc},
			 #{twoUnitDesc},#{productRecordNo},
			 #{unitWeight},#{taxRate},
			 #{country},#{internalNumber},
			 #{createDateTime})
	</insert>
	
	<select id="findgjz" resultMap="SzqgOrderResultMap" parameterType="java.util.Map">
			SELECT * from item where ${gjz} 

	</select>
	
	<select id="findByIdToBG" resultMap="SzqgOrderResultMap">
		select * from szqg_order where id = #{id}
	</select>
	
	<select id="findByOrderNo" resultMap="SzqgOrderResultMap">
		select * from szqg_order where OrderNo = #{OrderNo}
	</select>
	
	<select id="findhzqd" resultMap="SzqgOrderResultMap" parameterType="java.util.Map">
			
SELECT * from item it ,(SELECT tb.mailno, tb.invtno, ts.itemsku,ts.itemcount,ts.unitprice,ts.allprice from t_order_bonded  tb,t_order_bonded_sku ts where tb.txLogisticID=ts.txLogisticID and tb.mailno in(
SELECT ask.mailno from annotation an, annotation_sku ask  where an.jobformid=ask.jobformid and ${gjz} )) t  where it.itemsku=t.itemsku ORDER BY it.internalNumber

	</select>
	
	<update id="updatebygjz" parameterType="SzqgItem">
		update szqg_order set ${notes} ,commitTime='${status}' where id = '${sellerRecord}'
	</update>
	
	<update id="updateAtB" parameterType="SzqgItem">
		update szqg_order set ${A} where ${B}
	</update>
	
	<insert id="batchInsert" parameterType="SzqgOrder">
		INSERT INTO szqg_order (trafNo,trafMode,agentName,agentCode,customsCode,portCode,copNo,assureCode,abroadCoName,abroadCo,totalCount,createDateTime,userId,buyerIdType,buyerRegNo,currency,consigneeIdType,consigneeIdNumber,strategy,acturalPaid,taxTotal,freight,discount,goodsValue,carrier,mailno,consignee,buyerName,buyerIdNumber,consigneePrvince,consigneeCity,
		consigneeCounty,consigneeAddress,consigneeTelephone,orderNo,grossWeight,country,voyageNo,billNo,payTransactionId,
		status,logisticsCode,logisticsName,payCode,payName,ebpCode,ebpName,proxyCode,proxyName,buyerTelephone,
		netWeight,entryType)
		VALUES
		<foreach collection="list" item="SzqgOrder" separator="," >
  		(
  			'01','5','义乌市六六顺科技有限公司','3318960DDU','2921','2921',#{SzqgOrder.copNo},'3318960DDU','GOODS KOREA Co.,Ltd.','SZ13300001',#{SzqgOrder.totalCount},now(),'2','1','N','142',#{SzqgOrder.consigneeIdType},#{SzqgOrder.consigneeIdNumber},
			#{SzqgOrder.strategy},#{SzqgOrder.acturalPaid},#{SzqgOrder.taxTotal},#{SzqgOrder.freight},#{SzqgOrder.discount},#{SzqgOrder.goodsValue},'ZWY',#{SzqgOrder.mailno},#{SzqgOrder.consignee},#{SzqgOrder.buyerName},#{SzqgOrder.buyerIdNumber},
			#{SzqgOrder.consigneePrvince},#{SzqgOrder.consigneeCity},#{SzqgOrder.consigneeCounty},
			#{SzqgOrder.consigneeAddress},#{SzqgOrder.consigneeTelephone},#{SzqgOrder.orderNo},
			#{SzqgOrder.grossWeight},#{SzqgOrder.country},#{SzqgOrder.voyageNo},#{SzqgOrder.billNo},
			#{SzqgOrder.payTransactionId},'0',#{SzqgOrder.logisticsCode},#{SzqgOrder.logisticsName},
			#{SzqgOrder.payCode},#{SzqgOrder.payName},#{SzqgOrder.ebpCode},#{SzqgOrder.ebpName},#{SzqgOrder.proxyCode},#{SzqgOrder.proxyName},
			#{SzqgOrder.buyerTelephone},#{SzqgOrder.netWeight},#{SzqgOrder.entryType}
		)
  		</foreach>
	</insert>
	
	<update id="updateAuditstatus3" parameterType="SzqgOrder">
		update szqg_order set  qdzt = #{qdzt}, status = #{status} where copNo = #{copNo} and status not in ('9')
	</update>
	
	<update id="updateYdzt" parameterType="SzqgOrder">
		update szqg_order set  ydzt = #{ydzt} where orderNo = #{orderNo} 
	</update>
	
	<select id="exportszqg" parameterType="com.what21.model.SzqgOrderExpot" resultType="com.what21.model.SzqgOrderExpot">
		SELECT * from szqg_order  so, szqg_order_sku ss 
		where  so.orderno=ss.orderno 
		
		<if test = 'billNo != null'>
			and so.billNo = #{billNo}
		</if>
		
	</select>
</mapper>